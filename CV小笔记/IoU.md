**IoU（Intersection over Union，交并比）**  是计算机视觉中用于衡量两个区域（如边界框、语义分割区域等）重叠程度的指标，广泛应用于目标检测、图像分割等任务中，用于评估预测结果与真实标注（Ground Truth）的匹配精度。

---

### **核心定义**

- **交集（Intersection）** ：预测区域与真实区域的重叠部分面积。

- **并集（Union）** ：预测区域与真实区域的合并总面积（交集 + 各自独立部分）。

- **IoU值**：交集面积与并集面积的比值，计算公式为：
  
  $$
  \text{IoU} = \frac{\text{Intersection}}{\text{Union}} = \frac{A_{\text{pred}} \cap A_{\text{true}}}{A_{\text{pred}} \cup A_{\text{true}}}
  $$
  
  **取值范围**：0（无重叠）到1（完全重合）。

---

### **图解示例**

- **目标检测**：预测框（Predicted BBox）与真实框（Ground Truth BBox）的交并比。  
  ![IoU示意图](https://miro.medium.com/v2/resize:fit:1400/1*5IQh16S2NWEt3g0xGdgTaA.png)  
  
  - 绿色框为真实框，红色框为预测框。
  - 黄色区域为交集，绿色+红色区域为并集。

- **图像分割**：预测掩码（Predicted Mask）与真实掩码（Ground Truth Mask）的像素级重叠率。

---

### **应用场景**

1. **目标检测评估**：
   
   - 判断预测框是否有效：通常设定阈值（如0.5），IoU ≥ 阈值则认为检测正确（True Positive）。
   - 用于非极大值抑制（NMS）：去除重叠率高的冗余预测框。

2. **语义分割评估**：
   
   - 计算每个类别的IoU，再取平均（mIoU）作为模型整体性能指标。

3. **模型训练**：
   
   - 作为损失函数的参考（如IoU Loss），但需结合可导的变体（如GIoU、DIoU）以支持梯度优化。

---

### **计算示例**

假设预测框和真实框的坐标分别为：

- **预测框**：左上角 (2,2)，右下角 (5,5)，面积 = 3×3=9。

- **真实框**：左上角 (3,3)，右下角 (6,6)，面积 = 3×3=9。
1. **计算交集**：
   
   - 交集左上角：(max(2,3), max(2,3)) = (3,3)
   - 交集右下角：(min(5,6), min(5,6)) = (5,5)
   - 交集面积 = 2×2=4

2. **计算并集**：
   
   - 并集面积 = 9 + 9 - 4 = 14

3. **IoU值**：
   
   $$
   \text{IoU} = \frac{4}{14} \approx 0.286
   $$

---

### **优缺点分析**

| **优点**       | **缺点**                         |
| ------------ | ------------------------------ |
| 直观反映重叠程度     | 对非重叠区域敏感（即使预测框靠近真实框但无重叠，IoU=0） |
| 与任务目标直接相关    | 作为损失函数不可导（需使用近似方法如GIoU）        |
| 广泛适用于不同形状的区域 | 对小目标检测误差敏感（像素级误差显著降低IoU）       |

---

### **改进版本**

为解决IoU的局限性，衍生出多种变体：

1. **GIoU（Generalized IoU）**：  
   - 引入最小闭包区域（包围两个框的最小矩形），解决无重叠时的梯度问题。
   - 公式：$$
     \text{GIoU} = \text{IoU} - \frac{\text{闭包区域面积 - 并集面积}}{\text{闭包区域面积}}
     $$

2. **DIoU（Distance IoU）**：  
   - 考虑中心点距离，加速收敛。
   - 公式：$$
     \text{DIoU} = \text{IoU} - \frac{\rho^2}{c^2}
     $$

其中 $ \rho $ 是中心点距离，$ c $ 是闭包区域对角线长度。

3. **CIoU（Complete IoU）**：  
   - 同时考虑重叠率、中心点距离和长宽比。

---

### **总结**

IoU是衡量目标检测或分割结果与真实标注匹配度的核心指标，直观且易于计算。尽管存在对零重叠敏感、不可导等缺点，但其改进版本（GIoU、DIoU等）已广泛应用于模型训练和评估，成为计算机视觉任务中不可或缺的评价工具。